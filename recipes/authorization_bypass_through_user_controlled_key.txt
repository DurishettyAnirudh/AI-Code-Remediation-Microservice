cwe: CWE-639
name: Authorization Bypass Through User-Controlled Key
languages: unspecified
tags: Base, Incomplete
---
Short Description:
The system's authorization functionality does not prevent one user from gaining access to
another user's data or record by modifying the key value identifying the data.

Secure Coding Checklist:
Do:
- PHASE:Architecture and Design:For each and every data access, ensure that the user has sufficient privilege to access the record that is being requested.
- PHASE:Architecture and Design Implementation:Make sure that the key that is used in the lookup of a specific user's record is not controllable externally by the user or that any tampering can be detected.
- PHASE:Architecture and Design:Use encryption in order to make it more difficult to guess other legitimate values of the key or associate a digital signature with the key so that the server can verify that there has been no tampering.
Don't:
- Access Control:Avoid situations leading toBypass Protection Mechanism:NOTE:Access control checks for specific user data or functionality can be bypassed.
- Access Control:Avoid situations leading toGain Privileges or Assume Identity:NOTE:Horizontal escalation of privilege is possible (one user can view/modify information of another user).
- Access Control:Avoid situations leading toGain Privileges or Assume Identity:NOTE:Vertical escalation of privilege is possible if the user-controlled key is actually a flag that indicates administrator status, allowing the attacker to gain administrative access.

Language-Agnostic Guidance:
Retrieval of a user record occurs in the system based on some key value that is under user
control. The key would typically identify a user-related record stored in the system and
would be used to lookup that record for presentation to the user. It is likely that an
attacker would have to be an authenticated user in the system. However, the authorization
process would not properly check the data access operation to ensure that the
authenticated user performing the operation has sufficient entitlements to perform the
requested data access, hence bypassing any other authorization checks present in the
system. For example, attackers can look at places where user specific data is retrieved
(e.g. search screens) and determine whether the key for the item being looked up is
controllable externally. The key may be a hidden field in the HTML form field, might be
passed as a URL parameter or as an unencrypted cookie variable, then in each of these
cases it will be possible to tamper with the key value. One manifestation of this weakness
is when a system uses sequential or otherwise easily-guessable session IDs that would
allow one user to easily switch to another user's session and read/modify their data.

::METHOD:Automated Static Analysis:DESCRIPTION:Automated static analysis, commonly
referred to as Static Application Security Testing (SAST), can find some instances of this
weakness by analyzing source code (or binary/compiled code) without having to execute it.
Typically, this is done by building a model of data flow and control flow, then searching
for potentially-vulnerable patterns that connect sources (origins of input) with sinks
(destinations where the data interacts with external components, a lower layer such as the
OS, etc.):EFFECTIVENESS:High::

::PHASE:Architecture and Design:DESCRIPTION:For each and every data access, ensure that
the user has sufficient privilege to access the record that is being
requested.::PHASE:Architecture and Design Implementation:DESCRIPTION:Make sure that the
key that is used in the lookup of a specific user's record is not controllable externally
by the user or that any tampering can be detected.::PHASE:Architecture and
Design:DESCRIPTION:Use encryption in order to make it more difficult to guess other
legitimate values of the key or associate a digital signature with the key so that the
server can verify that there has been no tampering.::

Sample Fix Idea (Pseudo-code):
```pseudo
# High-level remediation stub
if receives_untrusted_input():
    validate_against_allowlist()
    enforce_least_privilege()
    log_and_monitor()
```
