cwe: CWE-209
name: Generation of Error Message Containing Sensitive Information
languages: PHP, Java
tags: Base, Draft
---
Short Description:
The product generates an error message that includes sensitive information about its
environment, users, or associated data.

Secure Coding Checklist:
Do:
- PHASE:Implementation:Ensure that error messages only contain minimal details that are useful to the intended audience and no one else. The messages need to strike the balance between being too cryptic (which can confuse users) or being too detailed (which may reveal more than intended). The messages should not reveal the methods that were used to determine the error. Attackers can use detailed information to refine or optimize their original attack, thereby increasing their chances of success. If errors must be captured in some detail, record them in log messages, but consider what could occur if the log messages can be viewed by attackers. Highly sensitive information such as passwords should never be saved to log files. Avoid inconsistent messaging that might accidentally tip off an attacker about internal state, such as whether a user account exists or not.
- PHASE:Implementation:Handle exceptions internally and do not display errors containing potentially sensitive information to a user.
- PHASE:Implementation:Attack Surface Reduction:Use naming conventions and strong types to make it easier to spot when sensitive data is being used. When creating structures, objects, or other complex entities, separate the sensitive and non-sensitive data as much as possible.:EFFECTIVENESS:Defense in Depth
- PHASE:Implementation Build and Compilation:Compilation or Build Hardening:Debugging information should not make its way into a production release.
- PHASE:Implementation Build and Compilation:Environment Hardening:Debugging information should not make its way into a production release.
- PHASE:System Configuration:Where available, configure the environment to use less verbose error messages. For example, in PHP, disable the display_errors setting during configuration, or at runtime using the error_reporting() function.
- PHASE:System Configuration:Create default error pages or messages that do not leak any information.
Don't:
- Confidentiality:Avoid situations leading toRead Application Data:NOTE:Often this will either reveal sensitive information which may be used to launch another, more focused attack or disclose private information stored in the server. For example, an attempt to exploit a path traversal weakness (CWE-22) might yield the full pathname of the installed application. In turn, this could be used to select the proper number of .. sequences to navigate to the targeted file. An attack using SQL injection (CWE-89) might not initially succeed, but an error message could reveal the malformed query, which would expose query logic and possibly even passwords or other sensitive information used within the query.

Language-Agnostic Guidance:
::METHOD:Manual Analysis:DESCRIPTION:This weakness generally requires domain-specific
interpretation using manual analysis. However, the number of potential error conditions
may be too large to cover completely within limited time
constraints.:EFFECTIVENESS:High::METHOD:Automated Analysis:DESCRIPTION:Automated methods
may be able to detect certain idioms automatically, such as exposed stack traces or
pathnames, but violation of business rules or privacy requirements is not typically
feasible.:EFFECTIVENESS:Moderate::METHOD:Automated Dynamic Analysis:DESCRIPTION:This
weakness can be detected using dynamic tools and techniques that interact with the
software using large test suites with many diverse inputs, such as fuzz testing (fuzzing),
robustness testing, and fault injection. The software's operation may slow down, but it
should not become unstable, crash, or generate incorrect results. Error conditions may be
triggered with a stress-test by calling the software simultaneously from a large number of
threads or processes, and look for evidence of any unexpected
behavior.:EFFECTIVENESS:Moderate::METHOD:Manual Dynamic Analysis:DESCRIPTION:Identify
error conditions that are not likely to occur during normal usage and trigger them. For
example, run the program under low memory conditions, run with insufficient privileges or
permissions, interrupt a transaction before it is completed, or disable connectivity to
basic network services such as DNS. Monitor the software for any unexpected behavior. If
you trigger an unhandled exception or similar error that was discovered and handled by the
application's environment, it may still indicate unexpected conditions that were not
handled by the application itself.::METHOD:Automated Static Analysis:DESCRIPTION:Automated
static analysis, commonly referred to as Static Application Security Testing (SAST), can
find some instances of this weakness by analyzing source code (or binary/compiled code)
without having to execute it. Typically, this is done by building a model of data flow and
control flow, then searching for potentially-vulnerable patterns that connect sources
(origins of input) with sinks (destinations where the data interacts with external
components, a lower layer such as the OS, etc.)::

::PHASE:Implementation:DESCRIPTION:Ensure that error messages only contain minimal details
that are useful to the intended audience and no one else. The messages need to strike the
balance between being too cryptic (which can confuse users) or being too detailed (which
may reveal more than intended). The messages should not reveal the methods that were used
to determine the error. Attackers can use detailed information to refine or optimize their
original attack, thereby increasing their chances of success. If errors must be captured
in some detail, record them in log messages, but consider what could occur if the log
messages can be viewed by attackers. Highly sensitive information such as passwords should
never be saved to log files. Avoid inconsistent messaging that might accidentally tip off
an attacker about internal state, such as whether a user account exists or
not.::PHASE:Implementation:DESCRIPTION:Handle exceptions internally and do not display
errors containing potentially sensitive information to a
user.::PHASE:Implementation:STRATEGY:Attack Surface Reduction:DESCRIPTION:Use naming
conventions and strong types to make it easier to spot when sensitive data is being used.
When creating structures, objects, or other complex entities, separate the sensitive and
non-sensitive data as much as possible.:EFFECTIVENESS:Defense in
Depth::PHASE:Implementation Build and Compilation:STRATEGY:Compilation or Build
Hardening:DESCRIPTION:Debugging information should not make its way into a production
release.::PHASE:Implementation Build and Compilation:STRATEGY:Environment
Hardening:DESCRIPTION:Debugging information should not make its way into a production
release.::PHASE:System Configuration:DESCRIPTION:Where available, configure the
environment to use less verbose error messages. For example, in PHP, disable the
display_errors setting during configuration, or at runtime using the error_reporting()
function.::PHASE:System Configuration:DESCRIPTION:Create default error pages or messages
that do not leak any information.::

Sample Fix Idea (Pseudo-code):
```pseudo
# High-level remediation stub
if receives_untrusted_input():
    validate_against_allowlist()
    enforce_least_privilege()
    log_and_monitor()
```
