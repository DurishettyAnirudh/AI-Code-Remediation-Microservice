cwe: CWE-469
name: Use of Pointer Subtraction to Determine Size
languages: C, C++
tags: Base, Draft
---
Short Description:
The product subtracts one pointer from another in order to determine size, but this
calculation can be incorrect if the pointers do not exist in the same memory chunk.

Secure Coding Checklist:
Do:
- PHASE:Implementation:Save an index variable. This is the recommended solution. Rather than subtract pointers from one another, use an index variable of the same size as the pointers in question. Use this variable to walk from one pointer to the other and calculate the difference. Always validate this number.
Don't:
- Access Control:Integrity:Confidentiality:Availability:Avoid situations leading toModify Memory:Avoid situations leading toRead Memory:Avoid situations leading toExecute Unauthorized Code or Commands:Avoid situations leading toGain Privileges or Assume Identity:NOTE:There is the potential for arbitrary code execution with privileges of the vulnerable program.

Language-Agnostic Guidance:
::METHOD:Fuzzing:DESCRIPTION:Fuzz testing (fuzzing) is a powerful technique for generating
large numbers of diverse inputs - either randomly or algorithmically - and dynamically
invoking the code with those inputs. Even with random inputs, it is often capable of
generating unexpected results such as crashes, memory corruption, or resource consumption.
Fuzzing effectively produces repeatable test cases that clearly indicate bugs, which helps
developers to diagnose the issues.:EFFECTIVENESS:High::METHOD:Automated Static
Analysis:DESCRIPTION:Automated static analysis, commonly referred to as Static Application
Security Testing (SAST), can find some instances of this weakness by analyzing source code
(or binary/compiled code) without having to execute it. Typically, this is done by
building a model of data flow and control flow, then searching for potentially-vulnerable
patterns that connect sources (origins of input) with sinks (destinations where the data
interacts with external components, a lower layer such as the OS,
etc.):EFFECTIVENESS:High::

::PHASE:Implementation:DESCRIPTION:Save an index variable. This is the recommended
solution. Rather than subtract pointers from one another, use an index variable of the
same size as the pointers in question. Use this variable to walk from one pointer to the
other and calculate the difference. Always validate this number.::

Sample Fix Idea (Pseudo-code):
```pseudo
# High-level remediation stub
if receives_untrusted_input():
    validate_against_allowlist()
    enforce_least_privilege()
    log_and_monitor()
```
