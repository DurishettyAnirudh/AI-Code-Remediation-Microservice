cwe: CWE-130
name: Improper Handling of Length Parameter Inconsistency
languages: C, C++
tags: Base, Incomplete
---
Short Description:
The product parses a formatted message or structure, but it does not handle or incorrectly
handles a length field that is inconsistent with the actual length of the associated data.

Secure Coding Checklist:
Do:
- PHASE:Implementation:When processing structured incoming data containing a size field followed by raw data, ensure that you identify and resolve any inconsistencies between the size field and the actual size of the data.
- PHASE:Implementation:Do not let the user control the size of the buffer.
- PHASE:Implementation:Validate that the length of the user-supplied data is consistent with the buffer size.
Don't:
- Confidentiality:Integrity:Avoid situations leading toRead Memory:Avoid situations leading toModify Memory:Avoid situations leading toVaries by Context

Language-Agnostic Guidance:
If an attacker can manipulate the length parameter associated with an input such that it
is inconsistent with the actual length of the input, this can be leveraged to cause the
target application to behave in unexpected, and possibly, malicious ways. One of the
possible motives for doing so is to pass in arbitrarily large input to the application.
Another possible motivation is the modification of application state by including invalid
data for subsequent properties of the application. Such weaknesses commonly lead to
attacks such as buffer overflows and execution of arbitrary code.

::PHASE:Implementation:DESCRIPTION:When processing structured incoming data containing a
size field followed by raw data, ensure that you identify and resolve any inconsistencies
between the size field and the actual size of the
data.::PHASE:Implementation:DESCRIPTION:Do not let the user control the size of the
buffer.::PHASE:Implementation:DESCRIPTION:Validate that the length of the user-supplied
data is consistent with the buffer size.::

Sample Fix Idea (Pseudo-code):
```pseudo
# High-level remediation stub
if receives_untrusted_input():
    validate_against_allowlist()
    enforce_least_privilege()
    log_and_monitor()
```
