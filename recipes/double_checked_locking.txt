cwe: CWE-609
name: Double-Checked Locking
languages: Java
tags: Base, Draft
---
Short Description:
The product uses double-checked locking to access a resource without the overhead of
explicit synchronization, but the locking is insufficient.

Secure Coding Checklist:
Do:
- PHASE:Implementation:While double-checked locking can be achieved in some languages, it is inherently flawed in Java before 1.5, and cannot be achieved without compromising platform independence. Before Java 1.5, only use of the synchronized keyword is known to work. Beginning in Java 1.5, use of the volatile keyword allows double-checked locking to work successfully, although there is some debate as to whether it achieves sufficient performance gains. See references.
Don't:
- Integrity:Other:Avoid situations leading toModify Application Data:Avoid situations leading toAlter Execution Logic

Language-Agnostic Guidance:
Double-checked locking refers to the situation where a programmer checks to see if a
resource has been initialized, grabs a lock, checks again to see if the resource has been
initialized, and then performs the initialization if it has not occurred yet. This should
not be done, as it is not guaranteed to work in all languages and on all architectures. In
summary, other threads may not be operating inside the synchronous block and are not
guaranteed to see the operations execute in the same order as they would appear inside the
synchronous block.

::PHASE:Implementation:DESCRIPTION:While double-checked locking can be achieved in some
languages, it is inherently flawed in Java before 1.5, and cannot be achieved without
compromising platform independence. Before Java 1.5, only use of the synchronized keyword
is known to work. Beginning in Java 1.5, use of the volatile keyword allows double-checked
locking to work successfully, although there is some debate as to whether it achieves
sufficient performance gains. See references.::

Sample Fix Idea (Pseudo-code):
```pseudo
# High-level remediation stub
if receives_untrusted_input():
    validate_against_allowlist()
    enforce_least_privilege()
    log_and_monitor()
```
