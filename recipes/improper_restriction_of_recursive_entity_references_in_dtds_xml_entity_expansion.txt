cwe: CWE-776
name: Improper Restriction of Recursive Entity References in DTDs ('XML Entity Expansion')
languages: XML
tags: Base, Draft
---
Short Description:
The product uses XML documents and allows their structure to be defined with a Document
Type Definition (DTD), but it does not properly control the number of recursive
definitions of entities.

Secure Coding Checklist:
Do:
- PHASE:Operation:If possible, prohibit the use of DTDs or use an XML parser that limits the expansion of recursive DTD entities.
- PHASE:Implementation:Before parsing XML files with associated DTDs, scan for recursive entity declarations and do not continue parsing potentially explosive content.
Don't:
- Availability:Avoid situations leading toDoS: Resource Consumption (Other):NOTE:If parsed, recursive entity references allow the attacker to expand data exponentially, quickly consuming all system resources.

Language-Agnostic Guidance:
If the DTD contains a large number of nested or recursive entities, this can lead to
explosive growth of data when parsed, causing a denial of service.

::METHOD:Automated Static Analysis:DESCRIPTION:Automated static analysis, commonly
referred to as Static Application Security Testing (SAST), can find some instances of this
weakness by analyzing source code (or binary/compiled code) without having to execute it.
Typically, this is done by building a model of data flow and control flow, then searching
for potentially-vulnerable patterns that connect sources (origins of input) with sinks
(destinations where the data interacts with external components, a lower layer such as the
OS, etc.):EFFECTIVENESS:High::

::PHASE:Operation:DESCRIPTION:If possible, prohibit the use of DTDs or use an XML parser
that limits the expansion of recursive DTD
entities.::PHASE:Implementation:DESCRIPTION:Before parsing XML files with associated DTDs,
scan for recursive entity declarations and do not continue parsing potentially explosive
content.::

Sample Fix Idea (Pseudo-code):
```pseudo
# High-level remediation stub
if receives_untrusted_input():
    validate_against_allowlist()
    enforce_least_privilege()
    log_and_monitor()
```
